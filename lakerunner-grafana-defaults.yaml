# Grafana configuration for Lakerunner deployment
# This file contains configuration for both Grafana Setup and Service stacks

# Database configuration (used by Setup stack)
database:
  name: "lakerunner_grafana"
  user: "grafana"

# Container Images configuration (used by Service stack)
images:
  grafana: "grafana/grafana:latest"
  grafana_init: "public.ecr.aws/cardinalhq.io/lakerunner/initcontainer-grafana:latest"

# Grafana service configuration (used by Service stack)
grafana:
  image: "grafana/grafana:latest"
  cpu: 512
  memory_mib: 1024
  replicas: 1
  ingress:
    port: 3000
    health_check_path: "/api/health"
  environment:
    GF_SECURITY_ADMIN_USER: "lakerunner"
    GF_SECURITY_ADMIN_PASSWORD: "from_secret"  # This will be replaced with secret from AWS Secrets Manager
    GF_SERVER_HTTP_PORT: "3000"
    GF_SERVER_ROOT_URL: "%(protocol)s://%(domain)s:%(http_port)s"
    GF_INSTALL_PLUGINS: "https://github.com/cardinalhq/cardinalhq-lakerunner-datasource/releases/download/v1.2.0-rc.20/cardinalhq-lakerunner-datasource.zip;cardinalhq-lakerunner-datasource"
    GF_PATHS_PROVISIONING: "/etc/grafana/provisioning"
    GF_SECURITY_ALLOW_EMBEDDING: "true"
    # PostgreSQL database configuration
    GF_DATABASE_TYPE: "postgres"
    GF_DATABASE_SSL_MODE: "require"
  database:
    type: "postgres"
    ssl_mode: "require"
  health_check:
    type: "curl"
    command: ["curl", "-f", "http://localhost:3000/api/health"]

# API Keys configuration (for datasource setup)
api_keys:
  - organization_id: 12340000-0000-4000-8000-000000000000
    keys:
      - f70603aa00e6f67999cc66e336134887
