# Default configuration for core Lakerunner deployment
# This file contains configuration for the main three stacks: common, migration, and services

# API Keys configuration
api_keys:
  - organization_id: 12340000-0000-4000-8000-000000000000
    keys:
      - f70603aa00e6f67999cc66e336134887

# Storage Profiles configuration
storage_profiles:
  - bucket: "${BUCKET_NAME}"  # Will be replaced with actual bucket name
    cloud_provider: aws
    collector_name: lakerunner
    insecure_tls: false
    instance_num: 1
    organization_id: 12340000-0000-4000-8000-000000000000
    region: "${AWS_REGION}"  # Will be replaced with actual region
    use_path_style: true

# Container Images configuration
images:
  migration: "public.ecr.aws/cardinalhq.io/lakerunner:v1.3.6"
  go_services: "public.ecr.aws/cardinalhq.io/lakerunner:v1.3.6"

# MSK configuration
msk:
  instance_type: "kafka.t3.small"
  broker_nodes: 2
  storage_size_gb: 50
  enable_sasl_scram: true

# Service configurations for core Lakerunner services
services:
  lakerunner-pubsub-sqs:
    command: ["/app/bin/lakerunner", "pubsub", "sqs"]
    cpu: 1024
    memory_mib: 2048
    replicas: 1
    health_check:
      type: "go"
      command: ["/app/bin/lakerunner", "sysinfo"]
    environment: {}

  lakerunner-ingest-logs:
    command: ["/app/bin/lakerunner", "ingest-logs"]
    cpu: 1024
    memory_mib: 2048
    replicas: 2
    health_check:
      type: "go"
      command: ["/app/bin/lakerunner", "sysinfo"]
    environment: {}

  lakerunner-ingest-metrics:
    command: ["/app/bin/lakerunner", "ingest-metrics"]
    cpu: 1024
    memory_mib: 2048
    replicas: 1
    health_check:
      type: "go"
      command: ["/app/bin/lakerunner", "sysinfo"]
    environment: {}

  lakerunner-compact-logs:
    command: ["/app/bin/lakerunner", "compact-logs"]
    cpu: 1024
    memory_mib: 2048
    replicas: 2
    health_check:
      type: "go"
      command: ["/app/bin/lakerunner", "sysinfo"]
    environment: {}

  lakerunner-compact-metrics:
    command: ["/app/bin/lakerunner", "compact-metrics"]
    cpu: 1024
    memory_mib: 2048
    replicas: 2
    health_check:
      type: "go"
      command: ["/app/bin/lakerunner", "sysinfo"]
    environment: {}

  lakerunner-rollup-metrics:
    command: ["/app/bin/lakerunner", "rollup-metrics"]
    cpu: 1024
    memory_mib: 2048
    replicas: 2
    health_check:
      type: "go"
      command: ["/app/bin/lakerunner", "sysinfo"]
    environment: {}

  lakerunner-sweeper:
    command: ["/app/bin/lakerunner", "sweeper"]
    cpu: 256
    memory_mib: 512
    replicas: 1
    health_check:
      type: "go"
      command: ["/app/bin/lakerunner", "sysinfo"]
    environment: {}

  lakerunner-query-api:
    command: ["/app/bin/lakerunner", "query-api"]
    cpu: 1024
    memory_mib: 2048
    replicas: 1
    ingress:
      port: 7101
      container_port: 8080
      attach_alb: true
      health_check_path: "/healthz"
      health_check_port: 8090
    health_check:
      type: "go"
      command: ["/app/bin/lakerunner", "sysinfo"]
    environment:
      EXECUTION_ENVIRONMENT: "ecs"
      QUERY_WORKER_SERVICE_NAME: "lakerunner-query-worker"
      # Note: QUERY_WORKER_CLUSTER_NAME is set dynamically in the template

  lakerunner-query-worker:
    command: ["/app/bin/lakerunner", "query-worker"]
    cpu: 2048
    memory_mib: 8192
    replicas: 2
    ingress:
      port: 8081
      description: "From Query API"
    health_check:
      type: "go"
      command: ["/app/bin/lakerunner", "sysinfo"]
    environment: {}

  # Boxer services for compaction and rollup
  lakerunner-boxer-compact-logs:
    command: ["/app/bin/lakerunner", "boxer-compact-logs"]
    cpu: 256
    memory_mib: 512
    replicas: 1
    health_check:
      type: "go"
      command: ["/app/bin/lakerunner", "sysinfo"]
    environment: {}

  lakerunner-boxer-compact-metrics:
    command: ["/app/bin/lakerunner", "boxer-compact-metrics"]
    cpu: 256
    memory_mib: 512
    replicas: 1
    health_check:
      type: "go"
      command: ["/app/bin/lakerunner", "sysinfo"]
    environment: {}

  # lakerunner-boxer-compact-traces: (disabled for now)
  #   command: ["/app/bin/lakerunner", "boxer-compact-traces"]
  #   cpu: 256
  #   memory_mib: 512
  #   replicas: 1
  #   health_check:
  #     type: "go"
  #     command: ["/app/bin/lakerunner", "sysinfo"]
  #   environment: {}

  lakerunner-boxer-rollup-metrics:
    command: ["/app/bin/lakerunner", "boxer-rollup-metrics"]
    cpu: 256
    memory_mib: 512
    replicas: 1
    health_check:
      type: "go"
      command: ["/app/bin/lakerunner", "sysinfo"]
    environment: {}
